{{ define "main" }}
<div class="page-coupons container">
    <header class="page-header">
        <h1 class="page-title">{{ .Title }}</h1>
        
        {{ if .Content }}
        <div class="page-content">
            {{ .Content }}
        </div>
        {{ end }}
    </header>
    
    <div class="coupon-list">
        {{ $paginator := .Paginate (where .Site.RegularPages "Section" "coupons") }}
        {{ if $paginator.Pages }}
            {{ range $paginator.Pages }}
            <div class="coupon-item">
                <div class="coupon-inner">
                    <div class="coupon-thumbnail">
                        <img src="{{ .Params.thumbnail }}" alt="{{ .Title }}" />
                    </div>
                    <div class="coupon-content">
                        <h3 class="coupon-name">{{ .Title }}</h3>
                        <div class="coupon-amount">{{ .Params.amount }}</div>
                        <div class="coupon-rules">{{ .Params.rules }}</div>
                        <!-- 使用 .RelPermalink 确保正确生成嵌套路径 -->
                        <a href="{{ .RelPermalink }}" class="coupon-link">
                            查看详情 <span class="icon">→</span>
                        </a>
                    </div>
                </div>
            </div>
            {{ end }}
        {{ else }}
            <div class="no-coupons-message">
                <p>没有找到优惠券。请确保在 content/coupons/ 目录下有 markdown 文件。</p>
                
                <!-- 从数据文件显示优惠券，修复嵌套路径 -->
                {{ $coupons := .Site.Data.coupons.coupons }}
                {{ if $coupons }}
                    <div class="data-coupon-list">
                        <h2>从数据文件显示的优惠券：</h2>
                        {{ range $coupons }}
                        <div class="coupon-item">
                            <div class="coupon-inner">
                                <div class="coupon-thumbnail">
                                    <img src="{{ .thumbnail }}" alt="{{ .name }}" />
                                </div>
                                <div class="coupon-content">
                                    <h3 class="coupon-name">{{ .name }}</h3>
                                    <div class="coupon-amount">{{ .amount }}</div>
                                    <div class="coupon-rules">{{ .rules }}</div>
                                    <!-- 根据嵌套路径修改链接结构 -->
                                    <a href="{{ $.Site.BaseURL }}coupons/{{ .id }}/{{ .id }}/" class="coupon-link">
                                        查看详情 <span class="icon">→</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {{ end }}
                    </div>
                {{ end }}
            </div>
        {{ end }}
    </div>
    
    <div class="pagination-wrapper">
        {{ template "_internal/pagination.html" . }}
    </div>
</div>
{{ end }}